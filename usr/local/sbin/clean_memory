#!/bin/bash
#===============================================================================
# FILE:         /usr/local/sbin/clean_memory
#
# USAGE:        $ sudo clean_memory
#   OR          # clean_memory
# OPTIONS:      none
#
# DESCRIPTION:  ...
#                 ...
#
# REQUIREMENTS: coreutils (id and echo),...
#
# BUGS:         ---
# NOTES:        ---
# AUTHOR:       Patrick Neumann, patrick@neumannsland.de
# COMPANY:      (privately)
#
# VERSION:      1.0 (stable)
# CREATED:      02.06.2015
#
# COPYRIGHT:    ---
# LICENSE:      ---
#
# HISTORY:      1.0 - Patrick Neumann - Initial (public) release
#===============================================================================

#=== FUNCTION ==================================================================
# NAME: error
# DESCRIPTION: Display red error messages surrounded by "Error" and "EXITING".
# PARAMETER 1: message (string)
#===============================================================================
function error () {
  /bin/echo -e "\033[01;31;40mError: ${1} . . . EXITING ! ! !\033[00m"
}

#-------------------------------------------------------------------------------
# Check, for root privileges.
#-------------------------------------------------------------------------------
if [[ 0 -ne "$( /usr/bin/id --user )" ]] ; then
  error "you need to be root"
  exit 1
fi

#-------------------------------------------------------------------------------
# ...
#-------------------------------------------------------------------------------
/bin/echo -e "\033[01;31;40mBefore:\033[00m"
/usr/bin/free --human
/bin/echo

#-------------------------------------------------------------------------------
# ...
#-------------------------------------------------------------------------------
/bin/echo 3 > /proc/sys/vm/drop_caches

#-------------------------------------------------------------------------------
# ...
#-------------------------------------------------------------------------------
/sbin/swapoff --all

#-------------------------------------------------------------------------------
# ...
#-------------------------------------------------------------------------------
/sbin/swapon --all

#-------------------------------------------------------------------------------
# ...
#-------------------------------------------------------------------------------
/bin/echo 3 > /proc/sys/vm/drop_caches

#-------------------------------------------------------------------------------
# ...
#-------------------------------------------------------------------------------
/bin/echo-e "\033[01;32;40mAfterwards:\033[00m"
/usr/bin/free --human

exit 0